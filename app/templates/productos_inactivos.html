{% extends 'layout.html' %}

{% block content %}
<div class="container mt-4">
  <h3 class="text-center mb-4">PRODUCTOS INACTIVOS</h3>

  <div class="row justify-content-between align-items-center mb-3">
    <div class="col-md-4">
      <a href="{{ url_for('productos.dashboard') }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left-circle"></i> Volver al Listado
      </a>
    </div>
    <div class="col-md-5 d-flex justify-content-end gap-2">
      <button class="btn btn-outline-danger btn-sm" onclick="exportarInactivos('pdf')">
        <i class="bi bi-file-earmark-pdf-fill"></i> Exportar PDF
      </button>
      <button class="btn btn-outline-success btn-sm" onclick="exportarInactivos('excel')">
        <i class="bi bi-file-earmark-excel-fill"></i> Exportar Excel
      </button>
    </div>
  </div>

  <table id="tablaInactivos" class="table table-bordered table-hover align-middle text-center w-100">
    <thead style="background-color: #000; color: #fff;">
      <tr>
        <th style="width: 50px;">ID</th>
        <th>Nombre</th>
        <th>Tipo</th>
        <th>Marca</th>
        <th>Modelo</th>
        <th>Color</th>
        <th>Stock</th>
        <th>Unidad</th>
        <th style="width: 110px;">Acci√≥n</th>
      </tr>
    </thead>
    <tbody>
      {% for producto in productos %}
      <tr>
        <td>{{ producto.id_producto }}</td>
        <td>{{ producto.nombre }}</td>
        <td>{{ producto.tipo_producto.nombre_tipo }}</td>
        <td>{{ producto.marca or '-' }}</td>
        <td>{{ producto.modelo_impresora or '-' }}</td>
        <td>{{ producto.color or '-' }}</td>
        <td class="{% if producto.stock == 0 %}text-danger{% elif producto.stock <= 5 %}text-warning{% else %}text-success{% endif %}">
          {{ producto.stock }}
        </td>
        <td>{{ producto.unidad or '-' }}</td>
        <td class="acciones d-flex justify-content-center">
          <form method="POST" action="{{ url_for('productos.reactivar_producto', id_producto=producto.id_producto) }}">
            <button type="button" class="btn btn-sm btn-outline-success reactivar-btn" data-id="{{ producto.id_producto }}">
            <i class="bi bi-arrow-repeat"></i> Reactivar
          </button>


            
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  $(document).ready(function () {
    if ($.fn.DataTable.isDataTable('#tablaInactivos')) {
      $('#tablaInactivos').DataTable().clear().destroy();
    }

    $('#tablaInactivos').DataTable({
      language: {
        url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
      },
      pageLength: 10,
      lengthMenu: [[10, 25, 50, -1], [10, 25, 50, 'Todos']]
    });
  });

  function exportarInactivos(formato) {
    window.open(`/productos/inactivos/${formato}`, '_blank');
  }
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".reactivar-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.dataset.id;
      fetch(`/productos/reactivar/${id}`, { method: "POST" })
        .then(res => {
          if (res.ok) {
            const fila = btn.closest("tr");
            if (fila) fila.remove();

            const toastHTML = `
              <div class="toast align-items-center text-white bg-success border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                  <div class="toast-body">Producto reactivado correctamente.</div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
              </div>`;
            const container = document.getElementById("toastContainer");
            container.insertAdjacentHTML("beforeend", toastHTML);
            new bootstrap.Toast(container.lastElementChild).show();
          } else {
            alert("Error al reactivar el producto.");
          }
        });
    });
  });
});
</script>



{% endblock %}



